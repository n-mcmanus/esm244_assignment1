---
title: "Task1"
author: "Nick McManus"
date: "2023-01-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) #always
library(readxl)    #use to import .xlsx data
library(lubridate) #dates
library(calecopal) #color themes
```

## Background

Information on the study and what will be done in this task.

Source: Knapp, R.A., C. Pavelka, E.E. Hegeman, and T.C. Smith. 2020. The Sierra Lakes Inventory Project: Non-Native fish and community composition of lakes and ponds in the Sierra Nevada, California ver 2. Environmental Data Initiative. <https://doi.org/10.6073/pasta/d835832d7fd00d9e4466e44eea87fab3>

## Data wrangling

First we'll read in the data.

```{r}
amphibians <- read_excel("data/sierra_amphibians.xlsx")
```

Now we'll wrangle the data to isolate our species of interest, *Rana muscosa.* Specifically, we only want to keep observations for adult, subadult, and tadpole *R. muscosa* across the study area. Then, we'll group and summarize the dataset to create our two graphs. 

```{r}
ramu <- amphibians %>% 
  # return only R. muscosa obs
  filter(amphibian_species == "RAMU") %>% 
  # remove obs for frogs in eggmass life stage
  filter(amphibian_life_stage != "EggMass") %>% 
  # isolate year from survey_date and move column
  mutate(year = lubridate::year(survey_date)) %>% 
  relocate(year, .before = amphibian_location) %>% 
  # remove unneeded variables
  select(!c(survey_date, amphibian_species, amphibian_state, amphibian_voucher))


### for 1st graph, we want to determine counts by life stage and year
ramu_counts_year <- ramu %>% 
  group_by(amphibian_life_stage, year) %>% 
  summarize(count = sum(amphibian_number, na.rm = T))


### for 2nd graph, determine counts by lake and return top 5
ramu_counts_lake <- ramu %>% 
  # remove obs for tadpoles
  filter(amphibian_life_stage != "Tadpole") %>% 
  # combine counts for adult + subadult by lake_id
  group_by(lake_id) %>% 
  summarize(count = sum(amphibian_number, na.rm = T)) %>% 
  # return only top 5
  slice_max(order_by = count, n = 5) 
  
```

## Graphs

Let's create our first graph, where we visualize the total number of R. muscosa counts each year across all water bodies by life stage.
```{r}
#colors <- cal_palette(name = "bigsur", n = 3, type = "continuous")

ggplot(data = ramu_counts_year, aes(x = year, y = count)) +
  #define geometry
  geom_col(position = 'dodge', aes(fill = amphibian_life_stage)) +
  #customize bar colors
  scale_fill_manual(values = cal_palette("lake")) +
  #set years on x axis
  scale_x_continuous(breaks = seq(from = 1995, to = 2002, by = 1)) +
  # add values to columns
  #geom_label(position = 'dodge', aes(label = count), size = 3.3) +
  #set labels
  labs(y = "Number of observed individuals",
       fill = "Life Stage") +
  #set theme
  theme_minimal()
```

Now let's make our second graph, which vizualizes the total number of adult and subadult R. muscosa observed in the five lakes with greatest observed counts. 
```{r}
ggplot(data = ramu_counts_lake, aes(x = fct_reorder(lake_id, count), 
                                    y = count)) +
  geom_col()+
  theme_minimal()
```

